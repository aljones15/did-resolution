<!DOCTYPE html>
<html>
  <head>
    <title>Decentralized Identifier Resolution (DID Resolution) v0.1</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline.
     -->
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove'></script>
    <!--script src='./respec-w3c-common.js' class='remove'></script-->
    <script src="./common.js"></script>
    <script type="text/javascript" class="remove">
      var respecConfig = {
        // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
        specStatus: "CG-DRAFT",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "did-resolution",

        // subtitle
        subtitle: "Resolution of Decentralized Identifiers (DIDs)",

        // if you wish the publication date to be other than today, set this
        // publishDate:  "2009-08-06",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // extend the bibliography entries
        localBiblio: ccg.localBiblio,

        github: "https://github.com/w3c-ccg/did-resolution",
        includePermalinks: false,

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI: "https://w3c-ccg.github.io/did-resolution/",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "2009-08-05",

        // editors, add as many as you like
        // only "name" is required
        editors: [
          { name: "Markus Sabadello", url: "https://www.linkedin.com/in/markus-sabadello-353a0821",
            company: "Danube Tech", companyURL: "https://danubetech.com/" },
          { name: "Dmitri Zagidulin", url: "https://www.linkedin.com/in/dzagidulin",
            company: "MIT CSAIL", companyURL: "http://computingjoy.com/" }
        ],

        // authors, add as many as you like.
        // This is optional, uncomment if you have authors as well as editors.
        // only "name" is required. Same format as editors.
        authors:
        [
          { name: "Markus Sabadello", url: "https://www.linkedin.com/in/markus-sabadello-353a0821",
            company: "Danube Tech", companyURL: "https://danubetech.com/" },
          { name: "Dmitri Zagidulin", url: "https://www.linkedin.com/in/dzagidulin",
            company: "MIT CSAIL", companyURL: "http://computingjoy.com/" }
        ],

        // name of the WG
        wg:           "Credentials Community Group",

        // URI of the public WG page
        wgURI:        "https://www.w3.org/community/credentials/",

        // name (with the @w3c.org) of the public mailing to which comments are due
        wgPublicList: "public-credentials",

        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        wgPatentURI:  "https://www.w3.org/community/about/agreements/cla/",
        maxTocLevel: 4,
        inlineCSS: true
      };
    </script>
    <style type="text/css">
      ol.algorithm {
        counter-reset: numsection;
        list-style-type: none;
      }
      ol.algorithm li {
        margin: 0.5em 0;
      }
      ol.algorithm li:before {
        font-weight: bold;
        counter-increment: numsection;
        content: counters(numsection, ".") ") ";
      }
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
Decentralized Identifiers (DIDs) are a new type of identifier for
verifiable, "self-sovereign" digital identity. DIDs are fully under the
control of the DID subject, independent from any centralized registry,
identity provider, or certificate authority. DIDs resolve to DID
Documents â€” simple documents that describe how to use that specific DID.
      </p>

      <p>
This document specifies the algorithms and guidelines for resolving DIDs
and dereferencing DID URLs.
      </p>
    </section>

    <section id='sotd'>
    <p>
      Comments regarding this document are welcome. Please file issues
      directly on <a href="https://github.com/w3c-ccg/did-resolution/issues/">GitHub</a>,
      or send them to
      <a href="mailto:public-credentials@w3.org">public-credentials@w3.org</a>
      (<a href="mailto:public-credentials-request@w3.org?subject=subscribe">subscribe</a>,
      <a href="https://lists.w3.org/Archives/Public/public-credentials/">archives</a>).
      </p>

      <p>
      Portions of the work on this specification have been funded by the
      United States Department of Homeland Security's Science and Technology
      Directorate under contracts HSHQDC-17-C-00019. The content of this
      specification does not necessarily reflect the position or the policy of
      the U.S. Government and no official endorsement should be inferred.
      </p>

      <p>
      Work on this specification has also been supported by the Rebooting the
      Web of Trust community facilitated by Christopher Allen, Shannon
      Appelcline, Kiara Robles, Brian Weller, Betty Dhamers, Kaliya Young, Kim
      Hamilton Duffy, Manu Sporny, Drummond Reed, Joe Andrieu, and Heather
      Vescent.
      </p>
    </section>

<section id="introduction">
<h1>Introduction</h1>

	<p><a>DID Resolution</a> is the process of obtaining a <a>DID Document</a> for a given <a>DID</a>. This is one
	of four required operations
	that can be performed on any DID ("Read"; the other ones being "Create", "Update", and "Deactivate") and defined
	by a <a>DID method</a>.
	Building on top of this, <a>DID URL Dereferencing</a> is the process of obtaining a resource for a given
	<a>DID URL</a>.
	Software and/or hardware that is able to execute these processes is called a <a>DID Resolver</a>.
	
	<p>This
	specification defines common
	requirements, algorithms including their inputs and results, architectural options, and various considerations for the
	<a>DID Resolution</a> and <a>DID URL Dereferencing</a> processes.</p>

	<p>Note that while this specification defines some base-level functionality for DID Resolution, the actual steps required
	to communicate with a DID's <a>Decentralized Identifier Registry</a> are defined by the applicable DID method specification.</p>

	<p><a>DID Resolution</a> and <a>DID URL Dereferencing</a> do not involve any authentication or authorization
	functionality. Anybody can perform the process, without requiring any credentials or non-public knowledge.</p>

	<p class="note">The difference between "resolving" a <a>DID</a> and "dereferencing" a <a>DID URL</a>
	is being thoroughly discussed by the community. E.g. see 
	<a href="https://github.com/w3c-ccg/did-spec/issues/166#issuecomment-464502719">this comment</a>.</p>

	<section id="conformance">

	</section>

</section>

<section id="terminology">
	<h1>Terminology</h1>

    <dl>
      <dt><dfn data-lt="DID|DIDs|decentralized identifiers">Decentralized Identifier</dfn> (DID)</dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="DIR|decentralized identifier registry|decentralized identifier registries">Decentralized Identifier Registry</dfn> (DIR)</dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Document</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Fragment</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Method</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Path</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Query</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Resolution</dt>
      <dd>An algorithm that takes a <a>DID</a> plus additional parameters as input and produces a <a>DID Document</a>
      or a <a>DID Resolution Result</a> as output. This algorithm relies on the "Read" operation of the applicable
      <a>DID method</a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Resolver</dt>
      <dd>Software and/or hardware that is capable of <a>DID Resolution</a> and optionally
      <a>DID URL Dereferencing</a> for at least one <a>DID method</a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID Resolution Result</dt>
      <dd>A data structure that represents the result of the <a>DID Resolution</a> or <a>DID URL Dereferencing</a> algorithm.
      May contain a <a>DID Document</a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID URL</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID URL Dereferencing</dfn></dt>
      <dd>An algorithm that takes a <a>DID URL</a> plus additional parameters as input and produces a <a>DID Document</a>,
      a <a>DID Resolution Result</a>, or various other types of resources as output. This algorithm relies
      on <a>DID Resolution</a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">Service Endpoint</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>

</section>

<section id="architectures">
	<h1>DID Resolver Architectures</h1>
	<p class="issue">TODO: Describe how <a>DID Resolvers</a> are implemented and used, describe the concept of methods.</p>

	<section id="did-resolver-architectures">
		<h2>Resolver Architectures</h1>
		<p class="issue" data-number="28">TODO: Describe local DID Resolvers vs. remote DID Resolvers, and implications for privacy, security and trust.</p>
		<p class="issue">TODO: A DID Resolver can add a <a href="https://w3c-ccg.github.io/did-spec/#proof-optional">proof</a> to a DID Document, discuss what this does and doesn't achieve.</p>
		<p class="issue">TODO: Discuss DID Resolution in constrained user agents such as mobile apps and browsers.</p>
		<p class="issue">TODO: A client could query multiple remote DID Resolvers and compare results.</p>

	</section>

	<section id="did-method-architectures">
		<h2>Method Architectures</h2>
		<p class="issue">TODO: Describe full nodes vs. light clients, blockchain explorer APIs, state proofs, etc.</p>

	</section>

</section>

<section id="resolving">
	<h1>Resolving a DID</h1>

	<p>This section defines the inputs and the algorithm of <a>DID Resolution</a>, which produces
	a <a>DID Document</a> or a <a>DID Resolution Result</a> as output.
	This algorithm relies on the "Read" operation of the applicable <a>DID method</a>.</p>

	<p>The abstract interface to this algorithm is:</p>

	<code>resolve ( did, input-parameters )</code>

	<div class="note">
	<p>The mechanics of the "Read" operation can vary considerably between
	<a>DID methods</a>.</p>
	<p>In particular, no assumption should be made that:</p>
	<ul>
	<li>... an immutable blockchain is used as (part of) the <a>Decentralized Identifier Registry</a>.</li>
	<li>... interaction with a remote network is required during execution of the "Read" operation.</li>
	<li>... an actual <a>DID Document</a> is stored in plain-text on a <a>Decentralized Identifier Registry</a>,
	or that the <a>DID Document</a> can simply be retrieved via a standard protocol such as HTTP(S).
	While some <a>DID methods</a> may define their "Read" operation this way, others may
	define more complex multi-step processes that involve on-the-fly construction of a "virtual" <a>DID Document</a>.</li>
	</ul>
	</div>

	<p class="issue">Maybe mention "resolution" of peer/off-ledger/microledger/edgechain DIDs (e.g. see
	<a href="https://lists.hyperledger.org/g/indy/topic/28597813">here</a> and 
	<a href="https://docs.google.com/presentation/d/1UnC_nfOUK40WS5TD_EhyDuFe5cStX-u0Z7wjoae_PqQ/">here</a>.</p>

	<p class="issue">Maybe mention "resolution" of DIDs that are simply wrapped public keys (e.g. see
	<a href="https://github.com/uport-project/secp256k1-did-resolver">here</a> and
	<a href="https://github.com/w3c-ccg/did-spec/pull/55">here</a>).</p>

	<section id="resolving-input">
		<h2>Input</h2>
		<p>The inputs of the <a>DID Resolution</a> algorithm are an <var>input <a>DID</a></var> and
		additional <var>input parameters</var>.</p>

		<section id="resolving-input-did">
			<h3>DID</h3>
			<p>The <var>input <a>DID</a></var> is REQUIRED for the <a>DID Resolution</a> algorithm.</p>
			<p>The `method-name` component of the <var>input <a>DID</a></var> is called the <var>input <a>DID method</a></var>.</p>

		</section>

		<section id="resolving-input-result-type">
			<h3><code>result-type</code></h3>
			<p>The <code>result-type</code> <var>input parameter</var> can be used to request a certain
			type of result.</p>
			<p>This <var>input parameter</var> is OPTIONAL.</p>
			<p>Possible values of this parameter are:</p>
			<ul>
			<li>`"did-document"` (default value): Request a <a>DID Document</a> as output.</li>
			<li>`"resolution-result"`: Request a <a>DID Resolution Result</a> as output (see <a href="#did-resolution-result"></a>).</li>
			</ul>
			<p class="issue">Discuss what this means for certain bindings (such as <a href="#bindings-https"></a>).</p>

		</section>

		<section id="resolving-input-version-id">
			<h3><code>version-id</code></h3>
			<p>The <code>version-id</code> input parameter can be used to request a specific
			version of a <a>DID Document</a>.</p>
			<p>This <var>input parameter</var> is OPTIONAL. It is mutually exclusive with <a href="#resolving-input-version-time"></a>.</p>
			<p>See Section <a href="#versioning"></a> for additional considerations.</p>
			<p>The possible values of this parameter are specific to the <var>input <a>DID method</a></var>.</p>
			<p class="note">
			Possible values may include sequential numbers, random UUIDs, content hashes, etc.
			</p>

		</section>

		<section id="resolving-input-version-time">
			<h3><code>version-time</code></h3>
			<p>The <code>version-time</code> input parameter can used to request a specific
			version of a <a>DID Document</a>.</p>
			<p>This <var>input parameter</var> is OPTIONAL. It is mutually exclusive with <a href="#resolving-input-version-id"></a>.</p>
			<p>See Section <a href="#versioning"></a> for additional considerations.</p>
			<p>The value of this parameter MUST be a string value of an [[!RFC3339]] combined date and time string representing
			the date and time the <a>DID Document</a> was current for the <var>input <a>DID</a></var>.</p>

			<p class="issue">
			Help, what's the difference in ReSpec between a `[[RFC3339]]` and `[[!RFC3339]]` reference ?
			</p>

		</section>

		<section id="resolving-input-no-cache">
			<h3><code>no-cache</code></h3>
			<p>The <code>no-cache</code> input parameter can be used to 
			request a certain kind of caching behavior.</p>
			<p>This <var>input parameter</var> is OPTIONAL.</p>
			<p>Possible values of this parameter are:</p>
			<ul>
			<li>`"false"` (default value): Caching of <a>DID Documents</a> is allowed.</li>
			<li>`"true"`: Request that caching is disabled and a fresh <a>DID Document</a> is retrieved from
			the <a>Decentralized Identifier Registry</a>.</li>
			</ul>
			<p>See Section <a href="#caching"></a> for additional considerations.</p>

		</section>

	</section>

	<section id="resolving-algorithm">
		<h2>Algorithm</h2>
		<p>The following <a>DID Resolution</a> algorithm MUST be implemented by a conformant <a>DID Resolver</a>.</p>
		<ol class="algorithm">
			<li>Validate that the <var>input <a>DID</a></var> conforms to the `did` rule of the
			<a href="https://w3c-ccg.github.io/did-spec/#generic-did-syntax">Generic DID Syntax</a>.
			If not, the <a>DID Resolver</a> MUST raise an error.</li>
			<li>Determine if the <var>input <a>DID method</a></var> is supported by the <a>DID Resolver</a>
			that implements this algorithm. If not, the <a>DID Resolver</a> MUST raise an error.</li>
			<li>Obtain the <a>DID Document</a> for the <var>input <a>DID</a></var> by executing the
			<a href="https://w3c-ccg.github.io/did-spec/#read-verify">Read</a> operation against the
			<var>input <a>DID</a>'s</var> <a>Decentralized Identifier Registry</a>, as defined by the <var>input <a>DID method</a></var>:
			<ol class="algorithm">
				<li>Besides the <var>input <a>DID</a></var>, all additional <var>input parameters</var> of
				this algorithm MUST be passed to the
				<a href="https://w3c-ccg.github.io/did-spec/#read-verify">Read</a> operation of the
				<var>input <a>DID method</a></var>.</li>
				<li>If the <var>input <a>DID</a></var> does not exist, return a null result.</li>
				<li>The result of the <a href="https://w3c-ccg.github.io/did-spec/#read-verify">Read</a> operation
				is called the <var>output <a>DID Document</a></var>.</li>
			</ol>
			</li>
			<li>Validate that the <var>output <a>DID Document</a></var> conforms to the 
			<a href="https://w3c-ccg.github.io/did-spec/#did-documents">serialization</a> of the <a>DID Document</a>
			<a href="https://w3c-ccg.github.io/did-spec/#data-model">data model</a>. If not,
			the <a>DID Resolver</a> MUST raise an error.</li>
			<li>If the value of <a href="#resolving-input-result-type"><code>result-type</code></a> <var>input
			parameter</var> is <code>null</code> or <code>"did-document"</code>:
			<ol class="algorithm">
				<li>Return the <var>output <a>DID Document</a></var>.</li>
			</ol>
			</li>
			<li>If the value to of <a href="#resolving-input-result-type"><code>result-type</code></a> <var>input
			parameter</var> is <code>"resolution-result"</code>:
			<ol class="algorithm">
				<li>Construct a <a>DID Resolution Result</a> and populate it with the <var>output <a>DID Document</a></var>
				as well as metadata about the processes that produced the result (see <a href="#did-resolution-result"></a>.
				This is called the <var>output <a>DID Resolution Result</a></var>.</li>
				<li>Return the <var>output <a>DID Resolution Result</a></var>.</li>
			</ol>
			</li>
		</ol>

		<p class="issue" data-number="5">There is discussion how a DID that has been
		<a href="https://w3c-ccg.github.io/did-spec/#deactivate">deactivated</a> should be treated during the <a>DID Resolution</a>
		process.</p>

		<p class="issue" data-number="13">Specify how signatures/proofs on a DID Document should be verified during
		the DID Resolution process.</p>

	</section>

</section>

<section id="dereferencing">
	<h1>Dereferencing a DID URL</h1>

	<p>This section defines the inputs and the algorithm of <a>DID URL Dereferencing</a>, which produces
	a <a>DID Document</a>, a <a>DID Resolution Result</a>, or various other types of resources as output.
	This algorithm relies on <a>DID Resolution</a>.</p>

	<p>The abstract interface to this algorithm is:</p>

	<code>dereference ( did-url, input-parameters )</code>

	<section id="dereferencing-input">
		<h2>Input</h2>
		<p>The inputs of the <a>DID URL Dereferencing</a> algorithm are an <var>input <a>DID URL</a></var> and
		additional <var>input parameters</var>.</p>

		<section id="dereferencing-input-did-url">
			<h3>DID URL</h3>
			<p>The <var>input <a>DID URL</a></var> is REQUIRED for the <a>DID URL Dereferencing</a> algorithm.</p>
			<p>The `didÌ€` component of the <var>input <a>DID URL</a> is called the <var>input <a>DID</a></var>.</p>

		</section>

		<section id="dereferencing-input-result-type">
			<h3><code>result-type</code></h3>
			<p>The <code>result-type</code> <var>input parameter</var> can be used to request a certain
			type of result.</p>
			<p>This <var>input parameter</var> is OPTIONAL.</p>
			<p>Possible values of this parameter are:</p>
			<ul>
			<li>`"did-document"` (default value): Request a <a>DID Document</a> as output.</li>
			<li>`"resolution-result"`: Request a <a>DID Resolution Result</a> as output (see <a href="#did-resolution-result"></a>).</li>
			</ul>
			<p class="issue">Discuss what this means for certain bindings (such as <a href="#bindings-https"></a>).</p>
			<p class="issue">Discuss additional result types that may exist for <a>DID URL Dereferencing</a> but
			do not exist for <a>DID Resolution</a>.</p>

		</section>

		<section id="dereferencing-input-service-type">
			<h3><code>service-type</code></h3>
			<p>The <code>service-type</code> input parameter can be supplied by a client to select a specific
			service from the DID Document.</p>
			<p>This <var>input parameter</var> is OPTIONAL.</p>

		</section>

		<section id="dereferencing-input-follow-redirect">
			<h3><code>follow-redirect</code></h3>
			<p>The <code>follow-redirect</code> input parameter can be supplied by a client as a hint to 
			instruct whether redirects should be followed.</p>
			<p>This <var>input parameter</var> is OPTIONAL.</p>
			<p>See Section <a href="#redirect"></a>.</p>

		</section>

	</section>

	<section id="dereferencing-algorithm">
		<h2>Algorithm</h2>
		<p>The following <a>DID URL Dereferencing</a> algorithm MUST be implemented by a conformant <a>DID Resolver</a>.</p>
		<ol class="algorithm">
			<li>Obtain the <a>DID Document</a> for the <var>input <a>DID</a></var> by executing the
			<a>DID Resolution</a> algorithm as defined in <a href="#resolving"></a>:
			<ol class="algorithm">
				<li>If the <var>input <a>DID URL</a></var> contains the matrix parameters <code>version-id</code> or
				<code>version-time</code>, then they MUST be passed as <var>input parameters</var> to the
				<a>DID Resolution</a> algorithm.</li>
				<li>If the <var>input <a>DID URL</a></var> contains
				<a href="https://w3c-ccg.github.io/did-spec/#method-specific-did-parameter-names"> method-specific
				matrix parameters</a>, then they MUST be passed as <var>input parameters</var> to the <a>DID
				Resolution</a> algorithm.</li>
				<li>If the <var>input <a>DID</a></var> does not exist, return a null result.</li>
				<li>The result is called the <var>resolved <a>DID Document</a></var>.</li>
			</ol>
			</li>
			<li>If the <var>input <a>DID URL</a></var> is equal to the <var>input <a>DID</a></var> itself:
			<pre class="example nohighlight">did:example:1234</pre>
			<ol class="algorithm">
				<li>Return the <var>resolved <a>DID Document</a></var>.</li>
			</ol>
			</li>
			<li>If the <var>input <a>DID URL</a></var> contains the matrix parameter <code>service</code> and
			optionally a <a>DID Path</a>, <a>DID Query</a>, and/or <a>DID Fragment</a>:
			<pre class="example nohighlight">did:example:1234;service=agent/profile?query#frag</pre>
			<ol class="algorithm">
				<li>From the <var>resolved <a>DID Document</a></var>, select the <a>service endpoint</a> whose <code>id</code>
				property contains a fragment which matches the value of the <code>service</code> matrix parameter of the
				<var>input <a>DID URL</a></var>. This is called the <var>input <a>service endpoint</a></var>.</li>
				<li>Execute the <a href="#service-endpoint-construction">Service Endpoint Construction</a> algorithm:
				<ol class="algorithm">
					<li>Read the value of the <code>serviceEndpoint</code> property of the
					<var>input <a>service endpoint</a></var>. This is called the <var>input <a>service endpoint</a> URL</var>.</li>
					<li>Pass the <var>input <a>DID URL </a></var> and <var>input <a>service endpoint</a> URL</var> to
					the <a href="#service-endpoint-construction">Service Endpoint Construction</a> algorithm.</li>
					<li>The result is called the <var>output <a>service endpoint</a> URL</var>.</li>
				</ol>
				</li>
				<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
			</ol>
			</li>
			<li>If the <var>input <a>DID URL</a></var> contains a <a>DID Fragment</a>:
			<pre class="example nohighlight">did:example:1234#keys-1</pre>
			<ol class="algorithm">
				<li>From the <var>resolved <a>DID Document</a></var>, select the JSON-LD object whose <code>id</code>
				property matches the <var>input <a>DID URL</a></var>. This is called the <var>output resource</var>.
				Selecting the JSON-LD object from the <a>DID Document</a> MUST take into account relative IRIs and
				the base IRI of the <var>resolved <a>DID Document</a></var>.</li>
				<li>Return the <var>output resource</var>.
				<div class="issue" data-number="9">
				<p>Mention relative IRIs and that the DID itself is considered the base IRI for
				the JSON-LD parser. Mention potential attack vector if <code>@base</code> is injected into the
				<a>DID Document</a>.</p>
				<p>Also see <a href="https://github.com/w3c-ccg/did-spec/issues/97">this discussion</a>
				on fully qualified DID URLs as the value of the <code>id</code> field.</p>
				</div>
				<p class="note">
				This use of the <a>DID Fragment</a> is consistent with the definition of the fragment identifier in
				[[RFC3986]]. It identifies a <em>secondary resource</em> which is a subset of the <em>primary resource</em>
				(the <a>DID Document</a>).
				</p>
				<p class="note">
				This use of the <a>DID Fragment</a> is furthermore consistent with the concept of Hash URIs
				Web [[COOL-URIS]].
				</p>
				<p class="issue">
				Perhaps we can find a good reference somewhere from RDF, JSON-LD or Solid specifications that defines
				clearly the ability to use the fragment for identifying a specific resource in an RDF document.
				</p>
				</li>
			</ol>
			</li>
		</ol>

	</section>
	
	<section>
		<h2>Additional Features</h2>
		<p class="note">This section lists additional <a>DID URL Dereferencing</a> features that are under discussion and
		have not yet been incorporated into the algorithm.</p>

		<section id="redirect">
			<h3>Redirect</h3>
			<p>A <a href="https://w3c-ccg.github.io/did-spec/#dfn-service-endpoints">service endpoint</a> may have
			a <code>serviceEndpoint</code> property with a value that is itself
			a DID. This is interpreted as a "DID redirect" from the input DID to another. In this case, a "child"
			DID Resolution process can be launched to get to a "final" service endpoint.</p>

			<p class="issue" data-number="7">See corresponding open issue.
			</p>

			<p class="issue" data-number="36">DID redirects could not only apply to a single service endpoint, but
			to an entire DID Document, therefore enabling portability use cases.
			</p>

			<pre class="example nohighlight">
{
   "id": "did:example:123456789abcdefghi#hub1",
   "type": "HubService",
   "serviceEndpoint": "did:example:xyz"
}
</pre>

		</section>

		<section id="proxy">
			<h3>Proxy</h3>
			<p>A DID Document may contain a "proxy" service type which would provide a mapping that 
			needs to be followed in order to resolve to a final service URL.</p>

			<p class="issue" data-number="35"></p>
			</p>

			<pre class="example nohighlight">
{
   "id": "did:example:123456789abcdefghi",
   "type": "ProxyService",
   "serviceEndpoint": "https://mydomain.com/proxy"
}
</pre>

		</section>

		<section id="json-pointer">
			<h3>JSON Pointer</h3>
			<div class="issue">
			<p>Several ways of selecting parts of a DID Document are being discussed, including the use
			of JSON pointer.</p>
			<p>See corresponding <a href="https://github.com/w3c-ccg/did-spec/pull/161">PR</a>.</p>
			</div>

		</section>

	</section>

	<h3>Example</h3>
	<p>Given the following <a>DID Document</a>:<p>
	<pre class="example nohighlight">
{
  "@context": ["https://w3id.org/did/v1", "https://w3id.org/security/v1"],
  "id": "did:example:123456789abcdefghi",
  "service": [{
    "id": "did:example:123456789abcdefghi#agent",
    "type": "AgentService",
    "serviceEndpoint": "https://agent.example.com/8377464"
  }, {
    "id": "did:example:123456789abcdefghi#hub",
    "type": "HubService",
    "serviceEndpoint": "https://hub.example.com/.identity/did:example:0123456789abcdef/"
  }, {
    "id": "did:example:123456789abcdefghi#messages",
    "type": "MessagingService",
    "serviceEndpoint": "https://example.com/messages/8377464"
  }]
}
</pre>
	<p>And given the following <var>input <a>DID URL</a></var>:</p>
	<pre class="example nohighlight">
did:example:123456789abcdefghi;service=messages/some/path?query#frag
</pre>
	<p>Then the final service endpoint is:</p>
	<pre class="example nohighlight">
https://example.com/messages/8377464/some/path?query#frag
</pre>

</section>

<section id="did-resolution-result">
	<h1>DID Resolution Result</h1>
	<p>This section defines a data structure that in some cases represents the result of the algorithms described
	in <a href="#resolving"></a> and <a href="#dereferencing"></a>. A <a>DID Resolution Result</a> contains
	a <a>DID Document</a> or other result as well as metadata about the processes that produced the result.</p>

	<p class="issue" data-number="23">See corresponding open issue.</p>
	<p class="issue">Need to define how this data structure works exactly, and whether it always contains
	a <a>DID Document</a> or can also contain other results.</p>

<pre class="example nohighlight" title="Example DID Resolution Result">
{
	"didDocument": {
		"id": "did:sov:WRfXPg8dantKVubE3HX8pw",
		"service": {
			"type": "xdi",
			"serviceEndpoint": "http://127.0.0.1:8080/xdi"
		},
		"authentication": {
			"type": "Ed25519SignatureAuthentication2018",
			"publicKey": ["did:sov:WRfXPg8dantKVubE3HX8pw#key-1"]
		},
		"publicKey": [{
			"id": "did:sov:WRfXPg8dantKVubE3HX8pw#key-1",
			"type": "Ed25519VerificationKey2018",
			"publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"
		}],
		"@context": "https://w3id.org/did/v1"
	},
	"resolverMetadata": {
		"driverId": "did:sov",
		"driver": "HttpDriver",
		"retrieved": "2019-06-01T19:73:24Z",
		"duration": 1015
	},
	"methodMetadata": {
		"nymResponse": {
			"result": {
				"data": "{\"dest\":\"WRfXPg8dantKVubE3HX8pw\",\"identifier\":\"V4SGRU86Z58d6TV7PBUe6f\",\"role\":\"0\",\"seqNo\":11,\"txnTime\":1524055264,\"verkey\":\"H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV\"}",
				"type": "105",
				"txnTime": 1.524055264E9,
				"seqNo": 11.0,
				"reqId": 1.52725687080231475E18,
				"identifier": "HixkhyA4dXGz9yxmLQC4PU",
				"dest": "WRfXPg8dantKVubE3HX8pw"
			},
			"op": "REPLY"
		},
		"attrResponse": {
			"result": {
				"identifier": "HixkhyA4dXGz9yxmLQC4PU",
				"seqNo": 12.0,
				"raw": "endpoint",
				"dest": "WRfXPg8dantKVubE3HX8pw",
				"data": "{\"endpoint\":{\"xdi\":\"http://127.0.0.1:8080/xdi\"}}",
				"txnTime": 1.524055265E9,
				"type": "104",
				"reqId": 1.52725687092557056E18
			},
			"op": "REPLY"
		}
	}
}
</pre>

	<section id="output-diddocument">
		<h2>DID Document</h2>
		<p>A <a>DID Document</a> associated with a <a>DID</a>. The result of <a href="#resolving"></a>.</p>

	</section>

	<section id="output-resolvermetadata">
		<h2>Resolver Metadata</h2>
		<div class="issue">
		<p>TODO: Describe DID Resolution metadata that is not method-specific, e.g.:</p>
		<ul>
		<li>Duration of the DID Resolution process.</li>
		<li>Versioning information about the DID Document (see Section <a href="#versioning"></a>).</li>
		<li>Caching information about the DID Document (see Section <a href="#caching"></a>).</li>
		</ul>
		</div>

	</section>

	<section id="output-methodmetadata">
		<h2>Method Metadata</h2>
		<div class="issue">
		<p>TODO: Describe DID Resolution metadata that is method-specific, e.g.:</p>
		<ul>
		<li>State proofs from the <a>Decentralized Identifier Registry</a>.</li>
		<li>Block number, index, transaction hash, number of confirmations, etc. of a record in the blockchain or other <a>Decentralized Identifier Registry</a>.</li>
		<li>Various URLs, IP addresses or other network information that was used during the DID Resolution process.</li>
		</ul>
		</div>

	</section>

	<p class="issue">For certain data, it may be debatable whether it should be part of the DID Document
	(i.e. data that describes the DID Subject), or whether it is metadata (i.e. data about the DID Document or about
	the DID Resolution process). For example the URL of the "Continuation DID Document" in the BTCR method.
	</p>

</section>

<section id="service-endpoint-construction">
	<h1>Service Endpoint Construction</h1>

	<p>This section defines the inputs and the algorithm of <a>Service Endpoint Construction</a>,
	which produces a <a>service endpoint</a> URL as output. This algorithm is used when service endpoints
	are selected during <a>DID URL Dereferencing</a> (see <a href="#dereferencing"></a>).</p>

	<p>In this section, <code>path</code>, <code>query</code>, and <code>fragment</code> are understood as defined in [[RFC3986]].</p>

	<section>
		<h2>Input</h2>

		<p>The inputs of the <a>Service Endpoint Construction</a> algorithm are an <var>input <a>DID URL</a></var> and an
		<var>input <a>service endpoint</a> URL</var>.</p>

		<p>The requirements for the inputs of the <a>Service Endpoint Construction</a> algorithm are as follows:</p>
		<ul>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MAY both have a <code>path</code> component.</li>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MUST NOT both have a <code>query</code> component.</li>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MUST NOT both have a <code>fragment</code> component.</li>
			<li>The <var>input <a>service endpoint</a> URL</var> MUST be an HTTP(S) URL.</li>
		</ul>

	</section>

	<section>
		<h2>Algorithm</h2>
		<ol class="algorithm">
			<li>Initialize a string <var>output <a>service endpoint</a> URL</var> to the value of the <var>input <a>service endpoint</a> URL</var></li>
			<li>If the <var>output <a>service endpoint</a> URL</var> has a <code>query</code> component, remove it.</li>
			<li>If the <var>output <a>service endpoint</a> URL</var> has a <code>fragment</code> component, remove it.</li>
			<li>Append the <code>path</code> component of the <var>input <a>DID URL</a></var> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>service endpoint</a> URL</var> has a <code>query</code> component, append <code>?</code> plus the <code>query</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>DID URL</a></var> has a <code>query</code> component, append <code>?</code> plus the <code>query</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>service endpoint</a> URL</var> has a <code>fragment</code> component, append <code>#</code> plus the <code>fragment</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>DID URL</a></var> has a <code>fragment</code> component, append <code>#</code> plus the <code>fragment</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
		</ol>

		<p class="issue">We could potentially allow a <code>query</code> components on both the
		<var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var>, if they both contain lists of
		key/value parameters that can be merged.</p>

		<p class="issue">Details of the Service Endpoint Construction algorithm have been discussed in April 2019
		on the CCG mailing list, e.g. <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Apr/0021.html">here</a>
		or <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Apr/0032.html">here</a>.</p>

		<p class="issue">Instead of defining our own algorithm, we could potentially re-use the "Relative Resolution"
		algorithm defined in [[RFC3986]].</p>

	</section>

	<section>
		<h3>Example</h3>
		<p>Given the following <var>input <a>service endpoint</a> URL</var>:<p>
		<p><code>
https://example.com/messages/8377464</code></p>
		<p>And given the following <var>input <a>DID URL</a></var>:</p>
		<p><code>
did:example:123456789abcdefghi;service=messages/some/path?query#frag
</code></p>
		<p>Then the <var>output <a>service endpoint</a> URL</var> is:</p>
		<p><code>
https://example.com/messages/8377464/some/path?query#frag
</code></p>

	</section>

</section>

<section id="bindings">
	<h1>Bindings</h1>
	<p>This section defines bindings for the abstract algorithms in sections <a href="#resolving"></a> and
	<a href="#dereferencing"></a>.</p>

	<section id="bindings-https">
		<h2>HTTP(S) Binding</h2>
		<p>A <a href="#did-resolver-architectures">remote DID Resolver</a> exposes the DID Resolution process (including all input parameters and output data) via an HTTP endpoint.</p>
		<p class="issue">TODO: Describe HTTP binding for DID Resolution process.</p>
		<p class="issue">TODO: How are DID Resolution input parameters passed via HTTP (query string? HTTP headers?).</p>
		<p class="issue">TODO: How is the output data (DID Document, metadata) returned via HTTP.</p>
		<p class="issue">TODO: What is the <a href="https://github.com/w3c-ccg/did-spec/issues/82">MIME type of a DID Document</a>?</p>

<pre class="example nohighlight" title="Example curl call to a DID Resolver via HTTP(S) Binding">
curl -X GET https://uniresolver.io/1.0/identifiers/did:sov:WRfXPg8dantKVubE3HX8pw
</pre>

	</section>

</section>

<section id="errors">
	<h1>Errors</h1>
	<p class="issue">Do we need to define a list of error conditions, codes, etc.</p>

</section>

<section id="security-privacy-considerations">
	<h1>Security and Privacy Considerations</h1>
	
	<section id="caching">
		<h2>Caching</h2>
		<p>A <a>DID Resolver</a> may maintain a generic cache of <a>DID Documents</a>. It may also maintain caches specific
		to certain <a>DID methods</a>.</p>
		<p>Caching behavior can be controlled by configuration of the <a>DID Resolver</a>,
		by the <a href="#resolving-input-no-cache">`no-cache`</a> input parameter, or by contents of the DID Document
		(e.g. a `time-to-live` field), or by a combination of these options.</p>
		<p class="issue" data-number="10">See corresponding open issue.</p>
		<p class="issue">Perhaps we can re-use caching mechanisms of other protocols such as HTTP.</p>
	
	</section>

	<section id="versioning">
		<h2>Versioning</h2>
		<p>If a <a href="#resolving-input-version-id">`version-id`</a> or
		<a href="#resolving-input-version-time">`version-time`</a> input parameter is provided, the <a>DID Resolution</a>
		algorithm returns a certain version of the <a>DID Document</a>.</p>
		<p>A DID Document MAY contain a version identifier that changes with each 
		<a href="https://w3c-ccg.github.io/did-spec/#update">Update</a> operation that is performed
		on a DID.</p>
		<p class="issue" data-number="12">See corresponding open issue.</p>
		<p class="note">While all DID methods MUST support the <a href="https://w3c-ccg.github.io/did-spec/#update">Update</a>
		operation, there is no requirement for DID methods to keep all previous DID Document versions, therefore
		not all DID methods support versioning.
		</p>
	
	</section>
	
	<section id="non-did-identifiers">
		<h2>Non-DID Identifiers</h2>
		<p class="issue" data-number="8">There is discussion on the relationship between DID Resolution and
		resolution of non-DID identifiers such as domain names, HTTP URIs, or e-mail addresses.</p>
	
	</section>

	<section id="did-method-governance">
		<h2>DID Method Governance</h2>
		<p class="issue" data-number="6">Describe which methods a DID Resolver should support, and potential implications.</p>

	</section>

</section>

<section class="appendix">
	<h1>Example</h1>

	<pre class="example nohighlight" title="Example curl call to a DID Resolver via HTTP(S) Binding">
curl -X GET https://uniresolver.io/1.0/identifiers/did:sov:WRfXPg8dantKVubE3HX8pw
</pre>

	<pre class="example nohighlight" title="Example DID Resolution Result">
{
	"didDocument": {
		"id": "did:sov:WRfXPg8dantKVubE3HX8pw",
		"service": {
			"type": "xdi",
			"serviceEndpoint": "http://127.0.0.1:8080/xdi"
		},
		"authentication": {
			"type": "Ed25519SignatureAuthentication2018",
			"publicKey": ["did:sov:WRfXPg8dantKVubE3HX8pw#key-1"]
		},
		"publicKey": [{
			"id": "did:sov:WRfXPg8dantKVubE3HX8pw#key-1",
			"type": "Ed25519VerificationKey2018",
			"publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"
		}],
		"@context": "https://w3id.org/did/v1"
	},
	"methodMetadata": {
		"nymResponse": {
			"result": {
				"data": "{\"dest\":\"WRfXPg8dantKVubE3HX8pw\",\"identifier\":\"V4SGRU86Z58d6TV7PBUe6f\",\"role\":\"0\",\"seqNo\":11,\"txnTime\":1524055264,\"verkey\":\"H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV\"}",
				"type": "105",
				"txnTime": 1.524055264E9,
				"seqNo": 11.0,
				"reqId": 1.52725687080231475E18,
				"identifier": "HixkhyA4dXGz9yxmLQC4PU",
				"dest": "WRfXPg8dantKVubE3HX8pw"
			},
			"op": "REPLY"
		},
		"attrResponse": {
			"result": {
				"identifier": "HixkhyA4dXGz9yxmLQC4PU",
				"seqNo": 12.0,
				"raw": "endpoint",
				"dest": "WRfXPg8dantKVubE3HX8pw",
				"data": "{\"endpoint\":{\"xdi\":\"http://127.0.0.1:8080/xdi\"}}",
				"txnTime": 1.524055265E9,
				"type": "104",
				"reqId": 1.52725687092557056E18
			},
			"op": "REPLY"
		}
	},
	"resolverMetadata": {
		"driverId": "did:sov",
		"driver": "HttpDriver",
		"retrieved": "2019-06-01T19:73:24Z",
		"duration": 1015
	}
}
</pre>
</section>

<section class="appendix">
	<h1>DID Resolution Resources</h1>

	<ol>
	<li><a href="https://w3c-ccg.github.io/did-spec/#did-resolvers">DID Resolvers in DID spec</a></li>
	<li><a href="https://github.com/decentralized-identity/universal-resolver/blob/master/docs/design-goals.md">Universal Resolver - Design Goals</a></li>
	<li><a href="https://github.com/decentralized-identity/universal-resolver/blob/master/docs/api-definition.md">Universal Resolver - API Definition</a></li>
	<li><a href="https://github.com/decentralized-identity/universal-resolver/blob/master/docs/architecture-drivers.md">Universal Resolver - Architecture and Drivers</a></li>
	<li><a href="https://github.com/digitalbazaar/did-client">did-client</a></li>
	<li><a href="https://github.com/uport-project/uport-did-resolver">uPort DID Resolver</a></li>
	</ol>

</section>

</body>
</html>
